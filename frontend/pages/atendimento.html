<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atendimento ao Paciente</title>

<<<<<<< HEAD
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="css/animacaoBack.css">
    <link rel="stylesheet" href="css/transicaoTela.css">

    <style>
        /* Vari√°veis de Cores e Fontes (adaptadas para Bootstrap) */
        :root {
            --primary-color: #0d6efd; /* Bootstrap primary blue */
            --secondary-color: #6c757d; /* Bootstrap secondary gray */
            --background-color: #f8f9fa; /* Bootstrap light background */
            --card-background: #ffffff; /* White for cards */
            --border-color: #dee2e6; /* Bootstrap border color */
            --text-color: #212529; /* Bootstrap dark text */
            --light-text-color: #6c757d; /* Bootstrap muted text */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            margin-top: 80px;
        }

        /* Custom styles for the navbar to match user's provided structure */
        .navbar.bg-transparente {
            background-color: var(--card-background) !important;
=======
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        window.initializeApp = initializeApp;
        window.getAuth = getAuth;
        window.signInAnonymously = signInAnonymously;
        window.signInWithCustomToken = signInWithCustomToken;
        window.onAuthStateChanged = onAuthStateChanged;
        window.getFirestore = getFirestore;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
        window.onSnapshot = onSnapshot;
        window.setLogLevel = setLogLevel;
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            line-height: 1.6;
            margin-top: 5rem;
        }

        .navbar {
            background-color: #ffffff !important;
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

<<<<<<< HEAD
        .navbar-brand .logo-img {
            color: var(--primary-color);
=======
        .logo-img {
            color: #2563eb;
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            font-weight: bold;
            font-size: 1.5rem;
            text-decoration: none;
            transition: color 0.2s ease-in-out;
        }

<<<<<<< HEAD
        .navbar-brand .logo-img:hover {
            color: #0a58ca;
        }

        /* Container principal para Sidebar e Main Content */
        .page-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* Menu Lateral (Sidebar) */
        .sidebar {
            width: 250px;
            background-color: var(--card-background);
=======
        .logo-img:hover {
            color: #1d4ed8;
        }

        .page-container {
            display: flex;
            min-height: calc(100vh - 5rem);
        }

        .sidebar {
            width: 250px;
            background-color: #ffffff;
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            flex-shrink: 0;
        }
<<<<<<< HEAD
        .sidebar-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
=======

        .sidebar-title {
            font-size: 1.2rem;
            color: #2563eb;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 5px;
        }

>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
<<<<<<< HEAD
=======

>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        .sidebar-button {
            width: 100%;
            text-align: left;
            background-color: transparent;
            border: none;
            padding: 12px 10px;
            font-size: 1rem;
<<<<<<< HEAD
            color: var(--text-color);
=======
            color: #1f2937;
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
<<<<<<< HEAD
        .sidebar-button i {
            margin-right: 10px;
        }
        .sidebar-button:hover {
            background-color: var(--primary-color);
            color: #fff;
        }

        /* Conte√∫do Principal (Main Content) */
=======

        .sidebar-button i {
            margin-right: 10px;
        }

        .sidebar-button:hover {
            background-color: #2563eb;
            color: #fff;
        }

>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        .main-content {
            flex-grow: 1;
            padding: 30px;
        }
<<<<<<< HEAD
        section {
            background-color: var(--card-background);
=======

        section {
            background-color: #ffffff;
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
<<<<<<< HEAD
        h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }
        #anotacoes {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
        }
        .exames-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        .exame-input-group {
            display: flex;
            flex-direction: column;
        }
        .exame-input-group label {
            font-weight: 700;
            margin-bottom: 5px;
        }
        .exame-input-group input, .exame-input-group textarea {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }
        .exame-input-group textarea {
            resize: vertical;
        }

        /* Estilos para a imagem do paciente */
=======

        h2, h3, h4 {
            color: #2563eb;
            margin-bottom: 15px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 5px;
        }

>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        .patient-photo {
            width: 100px;
            height: 100px;
            object-fit: cover;
<<<<<<< HEAD
            border: 2px solid var(--primary-color);
        }

        /* Estilos para a mensagem de carregamento e erro */
        .loading-message {
            color: var(--primary-color);
            text-align: center;
            font-size: 1.2rem;
            margin-top: 20px;
        }
        .error-message {
            color: #dc3545; /* Bootstrap danger red */
            text-align: center;
            font-size: 1.2rem;
            margin-top: 20px;
        }
        /* Estilos para a exibi√ß√£o de resultados din√¢micos */
        #dynamic-results {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            background-color: var(--card-background);
            margin-top: 20px;
        }
        #dynamic-results h4 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted var(--border-color);
        }
        .result-item:last-child {
            border-bottom: none;
        }
        /* Responsividade para a Navbar e Layout geral */
=======
            border: 2px solid #2563eb;
        }

        .exame-resultado-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .resultado-item {
            margin-bottom: 10px;
        }

        .trend-icon {
            margin-left: 10px;
            font-size: 1rem;
        }

        .trend-up {
            color: #10b981;
        }

        .trend-down {
            color: #ef4444;
        }

        .toggle-view-btn.active {
            background-color: #2563eb;
            color: #fff;
            border-color: #2563eb;
        }

        /* Responsive styles */
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        @media (max-width: 768px) {
            .navbar .container-fluid {
                flex-direction: column;
                align-items: flex-start;
            }
            .navbar-brand {
                margin-bottom: 10px;
            }
            .navbar-buttons {
                width: 100%;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                margin-top: 10px;
            }
<<<<<<< HEAD
            .navbar-buttons .btn {
                margin-bottom: 5px;
                margin-right: 5px !important;
                margin-left: 5px !important;
            }
            body {
                margin-top: 150px;
=======
            body {
                margin-top: 9rem;
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            }
            .page-container {
                flex-direction: column;
                min-height: auto;
            }
            .sidebar {
                width: 100%;
                padding: 15px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
            .sidebar-menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }
            .sidebar-button {
                flex: 1 1 auto;
                width: auto;
                text-align: center;
                justify-content: center;
            }
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>

<<<<<<< HEAD
    <nav class="navbar navbar-expand-lg bg-transparente fade-in-element">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://placehold.co/40x40/0d6efd/ffffff?text=LOGO" alt="Logo do Sistema" class="h-10 w-10 me-2 rounded-circle">
                <span class="logo-img" href="dashboard.html">Sistema Terapeuta</span>
            </a>
            <div class="navbar-buttons d-flex align-items-center">
                <a href="dashboard.html" class="btn btn-outline-primary me-2">Home</a>
                <a href="pacientes.html" class="btn btn-outline-primary me-2">Pacientes</a>
                <a href="agendamento.html" class="btn btn-outline-success me-2">Agendar</a>
                <a href="historico.html" class="btn btn-outline-secondary">Hist√≥rico</a>
                <button id="theme-toggle-btn" class="btn btn-outline-dark ms-2">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="page-container">
=======
    <nav class="navbar flex flex-col sm:flex-row items-start sm:items-center p-4">
        <a class="navbar-brand flex items-center mb-2 sm:mb-0" href="#">
            <img src="https://placehold.co/40x40/2563eb/ffffff?text=LOGO" alt="Logo do Sistema" class="h-10 w-10 mr-2 rounded-full">
            <span class="logo-img">Sistema Terapeuta</span>
        </a>
        <div class="navbar-buttons flex items-center flex-wrap justify-center sm:justify-end w-full sm:w-auto">
            <a href="#" class="btn btn-outline-primary px-3 py-2 rounded-md transition-colors duration-200 hover:bg-blue-600 hover:text-white border-blue-600 text-blue-600 mr-2">Home</a>
            <a href="#" class="btn btn-outline-primary px-3 py-2 rounded-md transition-colors duration-200 hover:bg-blue-600 hover:text-white border-blue-600 text-blue-600 mr-2">Pacientes</a>
            <a href="#" class="btn btn-outline-success px-3 py-2 rounded-md transition-colors duration-200 hover:bg-green-600 hover:text-white border-green-600 text-green-600 mr-2">Agendar</a>
            <a href="#" class="btn btn-outline-secondary px-3 py-2 rounded-md transition-colors duration-200 hover:bg-gray-600 hover:text-white border-gray-600 text-gray-600">Hist√≥rico</a>
            <button id="theme-toggle-btn" class="btn btn-outline-dark ml-2 px-3 py-2 rounded-md transition-colors duration-200 hover:bg-gray-800 hover:text-white border-gray-800 text-gray-800">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </nav>

    <div class="page-container flex flex-col sm:flex-row">
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        <aside class="sidebar">
            <h3 class="sidebar-title">A√ß√µes do Atendimento</h3>
            <ul class="sidebar-menu">
                <li><button id="btn-salvar" class="sidebar-button"><i class="fas fa-save"></i> Salvar Atendimento</button></li>
                <li><button id="btn-anexar" class="sidebar-button"><i class="fas fa-paperclip"></i> Anexar Exames</button></li>
                <li><button id="btn-historico" class="sidebar-button"><i class="fas fa-history"></i> Ver Hist√≥rico</button></li>
                <li><button id="btn-imprimir" class="sidebar-button"><i class="fas fa-print"></i> Imprimir</button></li>
            </ul>
        </aside>

<<<<<<< HEAD
        <main class="main-content">
            <section class="mb-4">
                <h2>Detalhes do Atendimento</h2>
                <div class="d-flex align-items-center mb-3">
                    <div class="flex-shrink-0 me-3">
                        <img id="patient-photo-circle" src="https://placehold.co/100x100/A0A0A0/ffffff?text=FOTO" alt="Foto do Paciente" class="rounded-circle patient-photo">
                    </div>
                   <div id="patient-data" class="flex-grow-1">
                        <h4>Paciente: <span id="infoNome"></span></h4>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><strong>Data e Hora:</strong> <span id="infoDataHora"></span></li>
                            <li class="list-group-item"><strong>Data de Nascimento:</strong> <span id="infoDataNascimento"></span></li>
                            <li class="list-group-item"><strong>Idade:</strong> <span id="infoIdade"></span></li>
                            <li class="list-group-item"><strong>Peso:</strong> <span id="infoPeso"></span></li>
                            <li class="list-group-item"><strong>Altura:</strong> <span id="infoAltura"></span></li>
                            <li class="list-group-item"><strong>IMC:</strong> <span id="infoIMC"></span></li>
                            <li class="list-group-item"><strong>Motivo da Consulta:</strong> <span id="infoMotivoConsulta"></span></li>
                            <li class="list-group-item"><strong>Tipo de Terapia:</strong> <span id="infoTipoTerapia"></span></li>
                            <li class="list-group-item"><strong>Observa√ß√µes:</strong> <span id="infoObservacoes"></span></li>
                            <li class="list-group-item"><strong>Condi√ß√µes de Sa√∫de:</strong> <span id="infoCondicoes"></span></li>
=======
        <main class="main-content flex-grow p-5">
            <section class="mb-4">
                <h2>Detalhes do Atendimento</h2>
                <div class="flex items-center mb-3">
                    <div class="flex-shrink-0 mr-3">
                        <img id="patient-photo-circle" src="https://placehold.co/100x100/A0A0A0/ffffff?text=FOTO" alt="Foto do Paciente" class="rounded-full patient-photo">
                    </div>
                   <div id="patient-data" class="flex-grow">
                        <h4>Paciente: <span id="infoNome"></span></h4>
                        <ul class="list-none p-0">
                            <li class="p-2 border-b border-gray-200"><strong>ID do Paciente:</strong> <span id="infoPatientId"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Data e Hora:</strong> <span id="infoDataHora"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Data de Nascimento:</strong> <span id="infoDataNascimento"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Idade:</strong> <span id="infoIdade"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Peso:</strong> <span id="infoPeso"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Altura:</strong> <span id="infoAltura"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>IMC:</strong> <span id="infoIMC"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Motivo da Consulta:</strong> <span id="infoMotivoConsulta"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Tipo de Terapia:</strong> <span id="infoTipoTerapia"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Observa√ß√µes:</strong> <span id="infoObservacoes"></span></li>
                            <li class="p-2 border-b border-gray-200"><strong>Condi√ß√µes de Sa√∫de:</strong> <span id="infoCondicoes"></span></li>
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
                        </ul>
                    </div>
                </div>
            </section>

            <section class="mb-4">
                <h3>Anota√ß√µes do Atendimento</h3>
<<<<<<< HEAD
                <textarea id="anotacoes" class="form-control" rows="10" placeholder="Anote aqui as informa√ß√µes do atendimento, observa√ß√µes, evolu√ß√£o, etc."></textarea>
            </section>

            <section>
                <h3>Resultados de Exames para Comparativo</h3>

                <!-- Controles de Upload de Exame -->
                <div class="mb-4">
                    <h4>Anexar e Processar Exame</h4>
                    <!-- Adicione o formul√°rio com o atributo enctype e o campo com o nome 'anexos' -->
                    <form id="formProcessarExame" enctype="multipart/form-data">
                        <div class="input-group">
                            <input type="file" class="form-control" id="examFile" name="anexos" accept=".pdf" required>
                            <button class="btn btn-primary" type="submit" id="processExamBtn"><i class="fas fa-upload"></i> Processar Exame</button>
                        </div>
                    </form>
                    <div id="statusMessage" class="mt-2"></div>
                </div>

                <div id="processed-exam-results" style="display: none;">
                    <h4>Resultados do Exame Processado</h4>
                    <p><strong>Tipo de Exame:</strong> <span id="examTypeDisplay"></span></p>
                    <p><strong>Nome do Paciente:</strong> <span id="patientNameDisplay"></span></p>

                    <h5>Resultados Detalhados</h5>
                    <div id="resultsList"></div>

                    <h5>Diagn√≥stico</h5>
                    <p id="diagnosisDisplay"></p>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">G√™nero do Paciente:</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male" checked>
                        <label class="form-check-label" for="genderMale">Masculino</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female">
                        <label class="form-check-label" for="genderFemale">Feminino</label>
                    </div>
                </div>

=======
                <textarea id="anotacoes" class="w-full p-4 border border-gray-300 rounded-lg text-sm resize-y" rows="10" placeholder="Anote aqui as informa√ß√µes do atendimento, observa√ß√µes, evolu√ß√£o, etc."></textarea>
            </section>

            <section>
                <h3>Anexos do Paciente</h3>
                <div id="anexos-container" class="anexos-list list-group">
                    <!-- A lista de anexos ser√° gerada aqui via JavaScript -->
                </div>
            </section>

            <section>
                <h3>An√°lise de Exames</h3>

                <div class="flex flex-wrap gap-2 mb-3" role="group">
                    <button type="button" class="btn px-4 py-2 rounded-lg transition-colors duration-200 toggle-view-btn active bg-blue-600 text-white" data-view="resultados">Resultados</button>
                    <button type="button" class="btn px-4 py-2 rounded-lg transition-colors duration-200 toggle-view-btn bg-gray-200 text-gray-800 hover:bg-gray-300" data-view="diagnostico">Diagn√≥stico</button>
                </div>

                <!-- Modal de Mensagem de Erro/Sucesso -->
                <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
                        <h4 id="modal-title" class="text-xl font-bold mb-4"></h4>
                        <p id="modal-message" class="text-gray-700 mb-4"></p>
                        <button id="modal-close-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg float-right">Fechar</button>
                    </div>
                </div>

                <!-- Come√ßo da aplica√ß√£o de IA -->
                <div class="card p-4 rounded-lg shadow-sm bg-gray-50">
                    <form id="exame-upload-form" class="mb-3">
                        <div class="flex gap-2">
                            <input type="file" class="form-control flex-grow rounded-lg p-2 border border-gray-300" id="exame-file" accept=".pdf" disabled>
                            <button class="btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" type="submit" id="btn-upload-exame">Processar Exame (Simulado)</button>
                        </div>
                    </form>

                    <!-- Indicador de Carregamento -->
                    <div id="loading-spinner" class="hidden text-center p-4">
                        <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full" role="status">
                            <span class="sr-only">Processando...</span>
                        </div>
                        <p class="mt-2 text-gray-500">Aguarde, a IA est√° processando o exame...</p>
                    </div>

                    <!-- √Årea para Exibir os Resultados e o Diagn√≥stico -->
                    <div id="exame-resultado-container" class="hidden">

                        <!-- VIEW DE RESULTADOS -->
                        <div id="resultados-view" class="hidden">
                            <h4 class="text-lg font-bold">Resultados Extra√≠dos</h4>
                            <div class="resultado-item">
                                <span>Nome do Paciente:</span>
                                <p id="exame-paciente-nome" class="font-normal"></p>
                            </div>
                            <div class="resultado-item">
                                <span>Tipo do Exame:</span>
                                <p id="exame-tipo" class="font-normal"></p>
                            </div>
                            <div class="resultado-item">
                                <h5 class="text-base font-semibold mt-4">Valores Extra√≠dos:</h5>
                                <ul id="exame-valores" class="list-none p-0">
                                    <!-- Valores com √≠cones ser√£o inseridos aqui via JS -->
                                </ul>
                            </div>
                            <hr class="my-4 border-gray-200">
                            <!-- Se√ß√£o de Par√¢metros -->
                            <div id="exame-parametros-view">
                                <h5 class="text-base font-semibold">Par√¢metros de Refer√™ncia</h5>
                                <ul id="exame-parametros" class="list-none p-0">
                                    <!-- Par√¢metros de refer√™ncia ser√£o inseridos aqui via JS -->
                                </ul>
                            </div>
                        </div>

                        <!-- VIEW DE DIAGN√ìSTICO -->
                        <div id="diagnostico-view" class="hidden">
                            <h4 class="text-lg font-bold">Diagn√≥stico da IA</h4>
                            <div class="resultado-item">
                                <span>An√°lise de IA:</span>
                                <p id="exame-diagnostico" class="font-normal"></p>
                                <div id="diagnostico-sources" class="text-xs text-gray-500 mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            </section>
        </main>
    </div>

<<<<<<< HEAD
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const genderMaleRadio = document.getElementById('genderMale');
            const genderFemaleRadio = document.getElementById('genderFemale');
            const maleExams = document.getElementById('male-imaging-exams');
            const femaleExams = document.getElementById('female-imaging-exams');
            const processedResultsSection = document.getElementById('processed-exam-results');
            const statusMessage = document.getElementById('statusMessage');

            // Elementos para exibir os dados do paciente
=======
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            setLogLevel('Debug');

            const btnSalvar = document.getElementById('btn-salvar');
            const anotacoesTextarea = document.getElementById('anotacoes');
            const exameFile = document.getElementById('exame-file');
            const btnUploadExame = document.getElementById('btn-upload-exame');
            const loadingSpinner = document.getElementById('loading-spinner');
            const exameResultadoContainer = document.getElementById('exame-resultado-container');

            const infoPatientId = document.getElementById('infoPatientId');
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            const infoNome = document.getElementById('infoNome');
            const infoDataNascimento = document.getElementById('infoDataNascimento');
            const infoIdade = document.getElementById('infoIdade');
            const infoPeso = document.getElementById('infoPeso');
            const infoAltura = document.getElementById('infoAltura');
            const infoIMC = document.getElementById('infoIMC');
<<<<<<< HEAD
=======
            const infoDataHora = document.getElementById('infoDataHora');
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
            const infoMotivoConsulta = document.getElementById('infoMotivoConsulta');
            const infoTipoTerapia = document.getElementById('infoTipoTerapia');
            const infoObservacoes = document.getElementById('infoObservacoes');
            const infoCondicoes = document.getElementById('infoCondicoes');
<<<<<<< HEAD
            const infoDataHora = document.getElementById('infoDataHora');

            // üîπ Fun√ß√£o para buscar e preencher os dados do paciente
            async function fetchPatientData(patientId) {
                // Simula√ß√£o de requisi√ß√£o ao backend
                try {
                    // Substitua esta linha pela sua chamada real √† API
                    const response = await fetch(`/api/pacientes/${patientId}`);
                    const data = await response.json();

                    if (response.ok) {
                        infoNome.textContent = data.nome;
                        infoDataNascimento.textContent = data.dataNascimento;
                        infoIdade.textContent = data.idade;
                        infoPeso.textContent = data.peso;
                        infoAltura.textContent = data.altura;
                        infoIMC.textContent = data.imc;
                        infoMotivoConsulta.textContent = data.motivoConsulta;
                        infoTipoTerapia.textContent = data.tipoTerapia;
                        infoObservacoes.textContent = data.observacoes;
                        infoCondicoes.textContent = data.condicoes;
                        infoDataHora.textContent = data.dataHora; // Adicionei essa info no objeto de exemplo
                    } else {
                        throw new Error(data.error || 'Erro ao carregar dados do paciente');
                    }
                } catch (error) {
                    console.error('Falha ao buscar dados do paciente:', error);
                    // Exibir uma mensagem de erro na interface, se necess√°rio
                }
            }

            // üîπ Fun√ß√£o para alternar a visibilidade dos exames
            function toggleExams() {
                if (genderFemaleRadio && maleExams && femaleExams) {
                    if (genderFemaleRadio.checked) {
                        femaleExams.classList.remove('d-none');
                        maleExams.classList.add('d-none');
                    } else {
                        maleExams.classList.remove('d-none');
                        femaleExams.classList.add('d-none');
                    }
                }
            }
            if (genderMaleRadio) {
                genderMaleRadio.addEventListener('change', toggleExams);
            }
            if (genderFemaleRadio) {
                genderFemaleRadio.addEventListener('change', toggleExams);
            }
            // Chame a fun√ß√£o uma vez para definir o estado inicial
            toggleExams();

            // üîπ Fun√ß√£o para lidar com o upload e processamento do exame
            const formProcessarExame = document.getElementById('formProcessarExame');
            const examFile = document.getElementById('examFile');
            const examTypeDisplay = document.getElementById('examTypeDisplay');
            const patientNameDisplay = document.getElementById('patientNameDisplay');
            const resultsList = document.getElementById('resultsList');
            const diagnosisDisplay = document.getElementById('diagnosisDisplay');

            if (formProcessarExame) {
                formProcessarExame.addEventListener('submit', async (e) => {
                    e.preventDefault(); // Impede o envio padr√£o do formul√°rio

                    const file = examFile.files[0];
                    if (!file) {
                        statusMessage.innerHTML = '<span class="text-danger">Por favor, selecione um arquivo PDF.</span>';
                        return;
                    }

                    const formData = new FormData();
                    // O nome 'anexos' deve corresponder ao nome do campo no Multer no backend
                    formData.append('anexos', file);

                    statusMessage.innerHTML = '<span class="text-primary loading-message">Processando exame... <i class="fas fa-spinner fa-spin"></i></span>';
                    processedResultsSection.style.display = 'none';

                    try {
                        const response = await fetch('/api/exames/processar', {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Erro no servidor.');
                        }

                        const result = await response.json();

                        // Atualiza a interface com os dados recebidos
                        examTypeDisplay.textContent = result.examType;
                        patientNameDisplay.textContent = result.patientName;
                        diagnosisDisplay.textContent = result.diagnosis;

                        // Limpa resultados anteriores e preenche a lista
                        resultsList.innerHTML = '';
                        for (const key in result.results) {
                            if (Object.hasOwnProperty.call(result.results, key)) {
                                const value = result.results[key];
                                const listItem = document.createElement('div');
                                listItem.className = 'result-item';
                                listItem.innerHTML = `<strong>${key}:</strong> <span>${value}</span>`;
                                resultsList.appendChild(listItem);
                            }
                        }

                        statusMessage.innerHTML = '<span class="text-success">Exame processado com sucesso!</span>';
                        processedResultsSection.style.display = 'block';

                    } catch (error) {
                        console.error('Erro:', error);
                        statusMessage.innerHTML = `<span class="text-danger">Erro ao processar: ${error.message}</span>`;
                        processedResultsSection.style.display = 'none';
                    }
                });
            }
=======
            const patientPhoto = document.getElementById('patient-photo-circle');

            const examePacienteNome = document.getElementById('exame-paciente-nome');
            const exameTipo = document.getElementById('exame-tipo');
            const exameDiagnostico = document.getElementById('exame-diagnostico');
            const exameValores = document.getElementById('exame-valores');
            const exameParametros = document.getElementById('exame-parametros');
            const anexosContainer = document.getElementById('anexos-container');
            const resultadosView = document.getElementById('resultados-view');
            const diagnosticoView = document.getElementById('diagnostico-view');
            const toggleViewBtns = document.querySelectorAll('.toggle-view-btn');
            const diagnosticoSources = document.getElementById('diagnostico-sources');

            const modal = document.getElementById('message-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            let db, auth, userId, patientId = 'paciente-exemplo-001';

            // Function to show custom modal
            function showModal(title, message) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modal.classList.remove('hidden');
            }

            modalCloseBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });

            // Function to toggle between views
            function toggleView(view) {
                if (view === 'resultados') {
                    resultadosView.classList.remove('hidden');
                    diagnosticoView.classList.add('hidden');
                } else {
                    resultadosView.classList.add('hidden');
                    diagnosticoView.classList.remove('hidden');
                }

                toggleViewBtns.forEach(btn => {
                    if (btn.dataset.view === view) {
                        btn.classList.add('active', 'bg-blue-600', 'text-white');
                        btn.classList.remove('bg-gray-200', 'text-gray-800', 'hover:bg-gray-300');
                    } else {
                        btn.classList.remove('active', 'bg-blue-600', 'text-white');
                        btn.classList.add('bg-gray-200', 'text-gray-800', 'hover:bg-gray-300');
                    }
                });
            }

            toggleViewBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const view = btn.dataset.view;
                    toggleView(view);
                });
            });

            // Function to calculate age
            function calcularIdade(dataNascimento) {
                const hoje = new Date();
                let idade = hoje.getFullYear() - dataNascimento.getFullYear();
                const mes = hoje.getMonth() - dataNascimento.getMonth();
                if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
                    idade--;
                }
                return idade;
            }

            // Function to calculate and classify BMI
            function calcularIMC(peso, altura) {
                const imc = peso / (altura * altura);
                let classificacao = '';
                if (imc < 18.5) {
                    classificacao = 'Abaixo do peso';
                } else if (imc >= 18.5 && imc < 24.9) {
                    classificacao = 'Peso normal';
                } else if (imc >= 25 && imc < 29.9) {
                    classificacao = 'Sobrepeso';
                } else if (imc >= 30 && imc < 34.9) {
                    classificacao = 'Obesidade Grau I';
                } else if (imc >= 35 && imc < 39.9) {
                    classificacao = 'Obesidade Grau II';
                } else {
                    classificacao = 'Obesidade Grau III (m√≥rbida)';
                }
                return `<strong>${imc.toFixed(2)}</strong> (${classificacao})`;
            }

            // Mock function to simulate attachment rendering
            function renderizarAnexos(anexos) {
                anexosContainer.innerHTML = '';
                if (anexos && anexos.length > 0) {
                    anexos.forEach(anexo => {
                        const li = document.createElement('li');
                        li.className = 'flex justify-between items-center p-3 border-b border-gray-200';
                        const anexoNome = document.createElement('span');
                        anexoNome.textContent = anexo.nome;
                        const anexoLink = document.createElement('a');
                        anexoLink.href = anexo.url;
                        anexoLink.target = '_blank';
                        anexoLink.className = 'bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 transition-colors text-sm';
                        anexoLink.innerHTML = `<i class="fas fa-eye mr-2"></i> Visualizar`;
                        li.appendChild(anexoNome);
                        li.appendChild(anexoLink);
                        anexosContainer.appendChild(li);
                    });
                } else {
                    anexosContainer.innerHTML = `<div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg" role="alert">Nenhum exame anexado a este atendimento.</div>`;
                }
            }

            async function initFirebaseAndLoadData() {
                try {
                    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                    if (!firebaseConfig || !firebaseConfig.projectId) {
                        console.error("Firebase config is missing or invalid. Please check the __firebase_config variable.");
                        showModal("Erro de Configura√ß√£o", "A configura√ß√£o do Firebase est√° faltando ou √© inv√°lida. O aplicativo pode n√£o funcionar corretamente.");
                        return;
                    }

                    const app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    await new Promise(resolve => {
                        onAuthStateChanged(auth, async (user) => {
                            if (user) {
                                userId = user.uid;
                            } else {
                                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                                try {
                                    if (initialAuthToken) {
                                        await signInWithCustomToken(auth, initialAuthToken);
                                        userId = auth.currentUser.uid;
                                    } else {
                                        const anonymousUser = await signInAnonymously(auth);
                                        userId = anonymousUser.user.uid;
                                    }
                                } catch (error) {
                                    console.error("Erro ao autenticar com Firebase:", error);
                                    showModal("Erro de Autentica√ß√£o", "N√£o foi poss√≠vel autenticar o usu√°rio. O salvamento de dados n√£o funcionar√°.");
                                    userId = `anon-${crypto.randomUUID()}`;
                                }
                            }
                            console.log("UserID:", userId);
                            resolve();
                        });
                    });

                    // Load patient data from Firestore using onSnapshot for real-time updates
                    const patientRef = doc(db, `artifacts/${appId}/public/data/patients`, patientId);
                    onSnapshot(patientRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            loadPatientData(data);
                        } else {
                            showModal("Aviso", "Nenhum dado encontrado para este paciente. Use o bot√£o Salvar para criar um novo registro.");
                        }
                    }, (error) => {
                        console.error("Erro ao carregar dados do paciente:", error);
                        showModal("Erro de Conex√£o", "N√£o foi poss√≠vel carregar os dados do paciente em tempo real. Verifique sua conex√£o ou as permiss√µes.");
                    });

                } catch (e) {
                    console.error("Erro na inicializa√ß√£o do Firebase:", e);
                    showModal("Erro Fatal", "Ocorreu um erro ao inicializar o Firebase. O aplicativo pode n√£o funcionar.");
                }
            }

            async function loadPatientData(data) {
                try {
                    infoPatientId.textContent = patientId;
                    infoNome.textContent = data.nome || 'N/A';
                    const dataNascimento = data.data_nascimento ? new Date(data.data_nascimento.seconds * 1000) : null;
                    if (dataNascimento && !isNaN(dataNascimento)) {
                        const dataNascimentoFormatada = dataNascimento.toLocaleDateString('pt-BR');
                        const idade = calcularIdade(dataNascimento);
                        infoDataNascimento.textContent = dataNascimentoFormatada;
                        infoIdade.textContent = idade;
                    } else {
                        infoDataNascimento.textContent = 'N/A';
                        infoIdade.textContent = 'N/A';
                    }
                    infoPeso.textContent = data.peso || 'N/A';
                    infoAltura.textContent = data.altura || 'N/A';
                    const peso = parseFloat(data.peso);
                    const altura = parseFloat(data.altura);
                    if (!isNaN(peso) && !isNaN(altura) && altura > 0) {
                        let alturaCorrigida = altura;
                        if (altura > 3 && altura <= 300) {
                            alturaCorrigida = altura / 100;
                        }
                        infoIMC.innerHTML = calcularIMC(peso, alturaCorrigida);
                    } else {
                        infoIMC.textContent = 'N/A';
                    }
                    if (data.foto_paciente) {
                        patientPhoto.src = data.foto_paciente;
                    } else {
                        patientPhoto.src = "https://placehold.co/100x100/A0A0A0/ffffff?text=FOTO";
                    }
                    const dataAgendamento = data.data_agendamento ? new Date(data.data_agendamento.seconds * 1000) : null;
                    if (dataAgendamento && !isNaN(dataAgendamento)) {
                        const dataHoraFormatada = dataAgendamento.toLocaleDateString('pt-BR') + ' √†s ' + dataAgendamento.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                        infoDataHora.textContent = dataHoraFormatada;
                    } else {
                        infoDataHora.textContent = 'N/A';
                    }
                    infoMotivoConsulta.textContent = data.motivo_consulta || 'N/A';
                    infoTipoTerapia.textContent = data.tipo_terapia || 'N/A';
                    infoObservacoes.textContent = data.observacoes || 'N/A';
                    infoCondicoes.textContent = data.condicoes_saude || 'N/A';
                    anotacoesTextarea.value = data.anotacoes || '';

                    // Mock data for attachments, as Firestore doesn't handle files
                    const anexos = data.anexos || [{ id: 1, nome: 'Exame de Sangue.pdf', url: 'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf' }];
                    renderizarAnexos(anexos);

                } catch (e) {
                    console.error("Erro ao carregar dados do agendamento:", e);
                    showModal("Erro", "Erro ao carregar os dados do atendimento. Verifique o console.");
                }
            }

            // Save notes to Firestore
            btnSalvar.addEventListener('click', async function() {
                if (!db || !patientId) {
                    showModal("Erro", "O Firebase n√£o foi inicializado corretamente.");
                    return;
                }

                try {
                    const patientRef = doc(db, `artifacts/${__app_id}/public/data/patients`, patientId);
                    await setDoc(patientRef, {
                        anotacoes: anotacoesTextarea.value,
                        // Mock data for demonstration purposes. In a real app, this would come from a form.
                        nome: "Ana Oliveira",
                        data_nascimento: new Date("1990-05-15"),
                        peso: "65 kg",
                        altura: "168 cm",
                        data_agendamento: new Date(),
                        motivo_consulta: "Dores de cabe√ßa recorrentes",
                        tipo_terapia: "Terapia Cognitivo-Comportamental",
                        observacoes: "Paciente apresenta ansiedade leve.",
                        condicoes_saude: "Nenhuma condi√ß√£o cr√¥nica conhecida.",
                    }, { merge: true });

                    showModal("Sucesso!", "Anota√ß√µes salvas com sucesso no Firestore.");

                } catch (e) {
                    console.error("Erro ao salvar anota√ß√µes:", e);
                    showModal("Erro", "Erro ao salvar anota√ß√µes. Verifique o console.");
                }
            });

            // ‚ö°Ô∏è Logic for AI analysis using Gemini API (simulated PDF content)
            btnUploadExame.addEventListener('click', async function(event) {
                event.preventDefault();
                loadingSpinner.classList.remove('hidden');
                exameResultadoContainer.classList.add('hidden');
                exameDiagnostico.textContent = '';
                diagnosticoSources.innerHTML = '';

                // Simulated lab results data. This would normally be extracted from the PDF.
                const mockAnalise = {
                    paciente_nome: 'Ana Oliveira',// preciso que essa linha contenha o nomedo paciente que esta sendo atendido
                    tipo_exame: 'Exame de Sangue',
                    resultados: [
                        { nome: 'Glicose', valor: '110 mg/dL', status: 'Alto', referencia: '70-99 mg/dL' },
                        { nome: 'Colesterol Total', valor: '215 mg/dL', status: 'Alto', referencia: '< 200 mg/dL' },
                        { nome: 'Hemoglobina', valor: '14.5 g/dL', status: 'Normal', referencia: '13-17 g/dL' },
                        { nome: 'Vitamina D', valor: '28 ng/mL', status: 'Baixo', referencia: '30-100 ng/mL' },
                    ]
                };

                // Fill in the UI with the mock data
                examePacienteNome.textContent = mockAnalise.paciente_nome || 'N/A';
                exameTipo.textContent = mockAnalise.tipo_exame || 'N/A';

                exameValores.innerHTML = '';
                exameParametros.innerHTML = '';

                if (mockAnalise.resultados && mockAnalise.resultados.length > 0) {
                    mockAnalise.resultados.forEach(item => {
                        const liValores = document.createElement('li');
                        liValores.className = 'p-2 border-b border-gray-200 flex items-center';
                        let iconHtml = '';
                        let colorClass = 'text-gray-600';
                        if (item.status === 'Alto') {
                            iconHtml = '<i class="fas fa-arrow-up trend-icon text-red-500"></i>';
                            colorClass = 'text-red-600 font-bold';
                        } else if (item.status === 'Baixo') {
                            iconHtml = '<i class="fas fa-arrow-down trend-icon text-green-500"></i>';
                            colorClass = 'text-green-600 font-bold';
                        }
                        liValores.innerHTML = `<span class="flex-grow"><strong>${item.nome}:</strong> ${item.valor}</span><span class="${colorClass}">${item.status}</span>${iconHtml}`;
                        exameValores.appendChild(liValores);

                        const liParametros = document.createElement('li');
                        liParametros.className = 'p-2 border-b border-gray-200';
                        liParametros.innerHTML = `<strong>${item.nome}:</strong> ${item.referencia || 'N/A'}`;
                        exameParametros.appendChild(liParametros);
                    });
                } else {
                    exameValores.innerHTML = `<li class="p-2 text-gray-500">Nenhum valor extra√≠do.</li>`;
                    exameParametros.innerHTML = `<li class="p-2 text-gray-500">Nenhum par√¢metro de refer√™ncia dispon√≠vel.</li>`;
                }

                // Construct the prompt for Gemini API
                const prompt = `Atue como um analista de sa√∫de. Analise os seguintes resultados de exames de sangue para o paciente ${mockAnalise.paciente_nome} e forne√ßa um diagn√≥stico resumido. Identifique os valores anormais e suas poss√≠veis implica√ß√µes. Seja profissional e conciso.

Resultados do Exame:
- Tipo de Exame: ${mockAnalise.tipo_exame}
- Glicose: ${mockAnalise.resultados.find(r => r.nome === 'Glicose').valor} (Refer√™ncia: ${mockAnalise.resultados.find(r => r.nome === 'Glicose').referencia})
- Colesterol Total: ${mockAnalise.resultados.find(r => r.nome === 'Colesterol Total').valor} (Refer√™ncia: ${mockAnalise.resultados.find(r => r.nome === 'Colesterol Total').referencia})
- Hemoglobina: ${mockAnalise.resultados.find(r => r.nome === 'Hemoglobina').valor} (Refer√™ncia: ${mockAnalise.resultados.find(r => r.nome === 'Hemoglobina').referencia})
- Vitamina D: ${mockAnalise.resultados.find(r => r.nome === 'Vitamina D').valor} (Refer√™ncia: ${mockAnalise.resultados.find(r => r.nome === 'Vitamina D').referencia})
`;
                try {
                    const apiKey = "";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const payload = {
                        contents: [{ parts: [{ text: prompt }] }],
                        tools: [{ "google_search": {} }],
                        systemInstruction: {
                            parts: [{ text: "Atue como um analista de sa√∫de experiente. Forne√ßa uma an√°lise sucinta e profissional dos resultados de exames m√©dicos, indicando poss√≠veis riscos ou necessidades de acompanhamento. Responda em portugu√™s. Crie uma resposta que possa ser dada a um paciente." }]
                        },
                    };

                    let response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    const candidate = result.candidates?.[0];
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }

                        exameDiagnostico.innerHTML = text.replace(/\n/g, '<br>');

                        if (sources.length > 0) {
                            diagnosticoSources.innerHTML = '<strong>Fontes:</strong><br>';
                            sources.forEach(source => {
                                const sourceLink = document.createElement('a');
                                sourceLink.href = source.uri;
                                sourceLink.target = '_blank';
                                sourceLink.textContent = source.title;
                                sourceLink.className = 'block hover:underline text-blue-500';
                                diagnosticoSources.appendChild(sourceLink);
                            });
                        }
                    } else {
                        throw new Error("Resposta da IA vazia ou inv√°lida.");
                    }
                } catch (error) {
                    console.error('Erro na an√°lise de IA:', error);
                    exameDiagnostico.textContent = 'N√£o foi poss√≠vel gerar um diagn√≥stico. Por favor, tente novamente.';
                } finally {
                    loadingSpinner.classList.add('hidden');
                    exameResultadoContainer.classList.remove('hidden');
                    toggleView('diagnostico');
                }
            });

            // Theme toggle logic
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            themeToggleBtn.addEventListener('click', () => {
                document.body.classList.toggle('bg-gray-900');
                document.body.classList.toggle('text-gray-100');
                document.body.classList.toggle('bg-gray-50');
                document.body.classList.toggle('text-gray-900');
                document.querySelectorAll('section, .sidebar, .navbar').forEach(el => {
                    el.classList.toggle('bg-white');
                    el.classList.toggle('bg-gray-800');
                });
                document.querySelectorAll('h2, h3, h4').forEach(el => {
                     el.classList.toggle('text-blue-600');
                     el.classList.toggle('text-blue-400');
                });
                const icon = themeToggleBtn.querySelector('i');
                if (icon.classList.contains('fa-moon')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
            });

            initFirebaseAndLoadData();
>>>>>>> 3959620b0900f06c3eea4d8f921ebede1266b5c5
        });
    </script>
</body>
</html>
